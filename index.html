import React, { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { motion } from "framer-motion";

const POLISH_WORDS = [
  "komputer", "pies", "wakacje", "samochód", "szkoła",
  "czekolada", "programowanie", "książka", "telefon", "muzyka",
  "przyjaciel", "historia", "miłość", "rower", "kawa",
];

const ALPHABET = "aąbcćdeęfghijklłmnńoópqrsśtuvwxyzźż".split("");

const getRandomWord = () => {
  const word = POLISH_WORDS[Math.floor(Math.random() * POLISH_WORDS.length)];
  return word.toLowerCase();
};

const HangmanDrawing = ({ wrongGuesses }: { wrongGuesses: number }) => {
  return (
    <svg height="250" width="200" className="mx-auto mt-4">
      {/* Szubienica */}
      <line x1="10" y1="240" x2="190" y2="240" stroke="black" strokeWidth="4" />
      <line x1="50" y1="240" x2="50" y2="20" stroke="black" strokeWidth="4" />
      <line x1="50" y1="20" x2="130" y2="20" stroke="black" strokeWidth="4" />
      <line x1="130" y1="20" x2="130" y2="50" stroke="black" strokeWidth="4" />

      {/* Części ciała */}
      {wrongGuesses > 0 && <circle cx="130" cy="70" r="20" stroke="black" strokeWidth="4" fill="none" />} {/* Głowa */}
      {wrongGuesses > 1 && <line x1="130" y1="90" x2="130" y2="150" stroke="black" strokeWidth="4" />} {/* Tułów */}
      {wrongGuesses > 2 && <line x1="130" y1="110" x2="100" y2="130" stroke="black" strokeWidth="4" />} {/* Lewa ręka */}
      {wrongGuesses > 3 && <line x1="130" y1="110" x2="160" y2="130" stroke="black" strokeWidth="4" />} {/* Prawa ręka */}
      {wrongGuesses > 4 && <line x1="130" y1="150" x2="110" y2="190" stroke="black" strokeWidth="4" />} {/* Lewa noga */}
      {wrongGuesses > 5 && <line x1="130" y1="150" x2="150" y2="190" stroke="black" strokeWidth="4" />} {/* Prawa noga */}
    </svg>
  );
};

export default function HangmanGame() {
  const [word, setWord] = useState(getRandomWord);
  const [guessedLetters, setGuessedLetters] = useState<string[]>([]);
  const [wrongGuesses, setWrongGuesses] = useState(0);
  const maxWrong = 6;

  const maskedWord = word
    .split("")
    .map((letter) => (guessedLetters.includes(letter) ? letter : "_"))
    .join(" ");

  const handleGuess = (guess: string) => {
    if (!guessedLetters.includes(guess)) {
      setGuessedLetters((prev) => [...prev, guess]);
      if (!word.includes(guess)) {
        setWrongGuesses((prev) => prev + 1);
      }
    }
  };

  const isWin = word.split("").every((letter) => guessedLetters.includes(letter));
  const isLose = wrongGuesses >= maxWrong;

  const resetGame = () => {
    setWord(getRandomWord());
    setGuessedLetters([]);
    setWrongGuesses(0);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-200 to-blue-300 flex flex-col items-center justify-center p-4">
      <Card className="max-w-md w-full shadow-2xl rounded-2xl">
        <CardContent className="flex flex-col gap-4 p-6">
          <h1 className="text-3xl font-bold text-center">Wisielec</h1>

          <HangmanDrawing wrongGuesses={wrongGuesses} />

          <motion.div
            className="text-center text-2xl tracking-widest font-mono"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
          >
            {maskedWord}
          </motion.div>

          <div className="grid grid-cols-7 gap-1 mt-4">
            {ALPHABET.map((letter) => (
              <Button
                key={letter}
                variant={guessedLetters.includes(letter) ? "outline" : "default"}
                disabled={guessedLetters.includes(letter) || isWin || isLose}
                onClick={() => handleGuess(letter)}
                className="text-sm p-1"
              >
                {letter}
              </Button>
            ))}
          </div>

          <p className="text-center mt-2">Niepoprawne próby: {wrongGuesses} / {maxWrong}</p>

          {(isWin || isLose) && (
            <div className="text-center mt-4">
              <p className="text-xl font-semibold">
                {isWin ? "🎉 Brawo! Odgadłeś hasło!" : `😢 Przegrałeś! Hasło to: ${word}`}
              </p>
              <Button className="mt-2" onClick={resetGame}>Zagraj ponownie</Button>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}
